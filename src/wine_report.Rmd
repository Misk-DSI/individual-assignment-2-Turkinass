---
title: "<strong>Red Wine Quality EDA</strong>"
author: "Turki Alsaedi, 16 Jun 2022 <br><br> Table of Contents"
output:
  html_document:
    numbersections: true
    toc: true

knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = "../"
    )
  })
---

```{=html}
<style>
a {
    text-decoration:underline;
    color: #333333;
}
#caption{
    color: #777777;
}
body {
text-align: justify;
max-width: 800px;
margin: auto;
font-size: 18px;
font-family: "Times New Roman", Times, serif;
}
table{
  position:relative;
  left: 50%;
  transform: translateX(-50%);
}
</style>
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(here)
library(tidyverse)
library(knitr)
library(GGally)
library(ggplot2)
library(gridExtra)
```

### Introduction
In 2009, samples of white and red Vinho Verde wine were collected to predict human taste in wine and use it to improve its quality and, eventually, increase wine sales. These samples were divided into to datasets: red and white wine quality [1, 2]. In this report, we will examine the red wine dataset and apply exploratory data analysis (EDA) and data munging on it.

To ensure that the wine is safe to consume and is of high quality, wine certification is required. This certification is assessed by several tests including physicochemical tests [1]â€”which was used to describe the wine in this dataset. Physicochemical tests characterize wine using 12 input variables described in Table 1.

```{r}
winequality <- read.csv(here("data/winequality-red.csv"))
winequality_arrt <- read.csv(here("data/winequality_variables_table.csv"))
```

### Data
```{r}
kable(winequality_arrt)
```
<p id="caption">Table 1: Red wine quality dataset input variables, units and their descriptions</p>

<br>

The red wine quality dataset consists of 12 variables (columns) with 1,599 observations (rows). A sample of the dataset is shown in Table 2.
```{r}
sample_n(winequality, 5) %>% 
  kable()
```
<p id="caption">Table 2: A sample of the dataset's observations</p>

### EDA
We will start the exploration by checking the correlations between the variables to check if there are any interesting findings.

```{r}
ggcorr(cor(winequality),  # make a correlation table
       label = TRUE,
       label_round = 2,   # show two decimal places
       label_size = 3,
       layout.exp = 2,    # prevent cropping
       hjust = 0.9)       # move titles horizontally
```
<p id="caption">Figure 1: Correlation plot of all variables</p>
<br>
Based on figure above, we can observe that there are 3 highly (>0.5) correlated variables and 4 are highly inversely correlated variables.

Correlated variables:

1. `density` / `fixed.acidity`
2. `citric.acid` / `fixed.acidity`
3. `total.sulfur.dioxide` / `free.sulfur.dioxide`

Inversely correlated variables:

1. `pH` / `fixed.acidityc`
2. `citric.acid` / `volatile.acidity`
3. `pH` / `citric.acid`
4. `alcohol` / `density`

Notes:

- Highest correlations are `density` / `fixed.acidity` (positive) and `pH` / `fixed.acidityc` (negative)
- The higher the amount of `fixed.acidity` in a red wine the denser it gets.
- `free.sulfur.dioxide` is a measure of free (i.e. `free.sulfur.dioxide`) and bound forms of sulfur dioxide.
- `pH` inverse correlation with `fixed.acidity` and `citric.acid` is is not surprising since `pH` is a measure of acidity.
- `citric.acid` has an inverse correlation with `volatile.acidity` because it is a fixed (onvolatile) acid.
- `alcohol` has less density than water (the measure of density) which explains the inverse correlation.
- <strong>None of the variables have a any high (>0.5) correlation with the `quality` of the wine.</strong>

<br>
Since no variable have major effect on our study variable `quality`. Let us take a look at its distribution to help us understand why.
<br>
```{r, fig.width = 8}
ggplot(winequality, aes(x = quality)) +
  geom_bar(stat = "count", fill="dark red") + 
  labs(x = "Wine quality", y = "No. of samples") +
  stat_count(geom = "text", 
             color = "white",
             aes(label = ..count..),
             position=position_stack(vjust=0.5))
```
<p id="caption">Figure 2: Number of wine samples based on its quality</p>
<br>
From the figure above we can see that:

- Samples quality range is [3-8]
- There are zero samples of wine with quality level (1, 2, 9, 10)
- 95% of the samples fall in quality level of 5, 6 and 7
- 82% of the samples fall in quality level of 5 and 6

This distribution may explain why variables does not affects the quality much since a large portion (82%) of it is limited to two quality levels (5 and 6).

<br>
To compensate the limited variation samples with different quality levels, we will consider variables with correlation that are above use a new threshold (>0.25) from Figure 1.

We see that there are 2 correlated variables to `quality` and one inversely correlated variable.

Correlated variables:

1. `quality` / `sulphates`
2. `quality` / `alcohol`

Inversely correlated variable:

1. `quality` / `volatile.acidity` 

<br>
Now let us see how each of  `sulphates`, `alcohol` and `volatile.acidity` affect the `quality` of the wine.

```{r, fig.width = 8}
ggplot(winequality,
       aes(x=as.factor(quality), # to consider it as distinct levels
           y=sulphates,
           fill=as.factor(quality))) +
  geom_boxplot() +
  labs(x = "", y="Sulphates (g/dm^3)") +
  guides(fill="none") -> figure3_p1

ggplot(winequality,
       aes(x=as.factor(quality),
           y=alcohol,
           fill=as.factor(quality))) +
  geom_boxplot() +
  labs(x = "Quality Level", y="Alcohol (%)") +
  guides(fill="none") -> figure3_p2

ggplot(winequality,
       aes(x=as.factor(quality),
           y=volatile.acidity,
           fill=as.factor(quality))) +
  geom_boxplot() +
  labs(x = "", y="Volatile acidity (g/dm^3)") +
  guides(fill="none") -> figure3_p3

grid.arrange(figure3_p1, figure3_p2, figure3_p3, nrow = 1)
```
<p id="caption">Figure 3: Box and whisker plot of wine quality level against sulphates, alcohol and volatile acidity </p>
<br>
From the above figure, we can see that:

- The positive `quality` correlation with `sulphates`, `alcohol` and inverse correlation with `volatile.acidity` is now clearer.
- Quality levels 5 and 6 have many outliers in all plots, which probably is due its larger sample size compared to the rest of levels.
- The large number of outliers in quality levels 5 and 6 (the most frequent samples) may explain its relatively low correlation with the other variables.

### Conclusion

In conclusion we found that the red wine quality dataset does not have enough variation in its samples when it comes to `quality`, with that in mind, the most influencing variables on its quality are `sulphates`, `alcohol` (positively). and `volatile.acidity` (negatively).

<br>

### References

[1] P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. Modeling wine preferences by data mining from physicochemical properties. In Decision Support Systems, Elsevier, 47(4):547-553, 2009.

[2] Cortez, Paulo, Cerdeira, A., Almeida, F., Matos, T. & Reis, J.. (2009). Wine Quality. UCI Machine Learning Repository.

<br>

### Source Code
This report is hosted on Github Pages and the repo can be accessed via [this link](https://github.com/Misk-DSI/individual-assignment-2-Turkinass).

<br><br><br>